<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo da Cobrinha - Solo</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background-color: #000;
  color: #fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 {
  font-size:3rem;
  color:#00ff00;
  margin:20px 0;
  border:4px solid #fff;
  padding:10px 20px;
  border-radius:12px;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.05);}
}
#topButtons {
  display:flex;
  gap:15px;
  margin-top:10px;
}
#topButtons button {
  padding:8px 16px;
  border-radius:8px;
  border:2px solid #fff;
  background:#111;
  color:#0f0;
  cursor:pointer;
  font-weight:bold;
}
#topButtons button:hover{background:#222;}
#setup, #seriesSelect, #gameContainer, #gameOver {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
label {margin:5px;}
button {
  padding:10px 20px;
  margin:5px;
  border-radius:10px;
  border:2px solid #fff;
  background:#111;
  color:#0f0;
  cursor:pointer;
  font-weight:bold;
}
button:hover {background:#222;}
canvas {
  border:3px solid #fff;
  background:#000;
  display:block;
  margin-top:20px;
}
#leaderboard {
  margin-top:20px;
  border:3px solid #fff;
  background:#111;
  padding:10px;
  border-radius:10px;
  width:450px;
}
#leaderboard table {
  width:100%;
  border-collapse: collapse;
}
#leaderboard th, #leaderboard td {
  border:1px solid #fff;
  padding:5px;
  text-align:center;
}
#leaderboard th {
  background:#222;
}
.seriesButton {
  margin:3px;
  padding:5px 10px;
  background:#111;
  color:#0f0;
  border:2px solid #fff;
  cursor:pointer;
  border-radius:6px;
}
.seriesButton.selected {background:#0f0; color:#000;}
</style>
</head>
<body>

<h1>Jogo da Cobrinha</h1>

<div id="topButtons">
  <button onclick="window.location.href='index.html'">P√°gina Inicial</button>
  <button onclick="window.location.href='processo.html'">Processo</button>
  <button onclick="window.location.href='pagina2.html'">P√°gina 2</button>
</div>

<!-- TELA DE SETUP: NOME E SALA -->
<div id="setup">
  <label>Nome:</label>
  <input type="text" id="playerName" placeholder="Digite seu nome">
  
  <label>Sala:</label>
  <input type="text" id="room" placeholder="Digite sua sala">
  
  <button id="toSeriesSelectBtn">Jogar Solo üêç</button>
</div>

<!-- TELA DE ESCOLHA DE S√âRIE -->
<div id="seriesSelect" style="display:none;">
  <h3>Escolha sua s√©rie:</h3>
  <div id="seriesOptions"></div>
  <button id="backToSetupBtn">Voltar</button>
  <button id="startGameBtn">Come√ßar Jogo</button>
</div>

<!-- TELA DO JOGO -->
<div id="gameContainer" style="display:none;">
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <div>
    <button id="exitBtn">Sair do minigame</button>
  </div>
</div>

<!-- TELA GAME OVER -->
<div id="gameOver" style="display:none;">
  <h2>Voc√™ Morreu!</h2>
  <button id="retryBtn">Recome√ßar</button>
  <button id="exitToSetupBtn">Sair do minigame</button>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard">
  <h3>Leaderboard Top 10</h3>
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Pontua√ß√£o</th>
        <th>S√©rie</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody"></tbody>
  </table>
</div>

<audio id="eatSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>

<script>
// LISTA DE SERIES
const seriesList = ["1¬∫A","1¬∫B","2¬∫A","2¬∫B","3¬∫A","3¬∫B","4¬∫A","4¬∫B","5¬∫A","5¬∫B","6¬∫A","6¬∫B","7¬∫A","7¬∫B","8¬∫A","8¬∫B","9¬∫A","9¬∫B"];
const seriesDiv = document.getElementById("seriesOptions");
let selectedSeries = null;
seriesList.forEach(s=>{
  const btn = document.createElement("button");
  btn.textContent = s;
  btn.className = "seriesButton";
  btn.onclick = ()=>{
    selectedSeries = s;
    document.querySelectorAll(".seriesButton").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
  };
  seriesDiv.appendChild(btn);
});

// ELEMENTOS
const setupDiv = document.getElementById("setup");
const toSeriesSelectBtn = document.getElementById("toSeriesSelectBtn");
const seriesSelectDiv = document.getElementById("seriesSelect");
const backToSetupBtn = document.getElementById("backToSetupBtn");
const startGameBtn = document.getElementById("startGameBtn");

const gameContainer = document.getElementById("gameContainer");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const gameOverDiv = document.getElementById("gameOver");
const retryBtn = document.getElementById("retryBtn");
const exitToSetupBtn = document.getElementById("exitToSetupBtn");
const exitBtn = document.getElementById("exitBtn");

const leaderboardBody = document.getElementById("leaderboardBody");
const eatSound = document.getElementById("eatSound");

let snake, food, direction, gameInterval;
let playerName, room;

// BOT√ïES FUNCIONANDO
toSeriesSelectBtn.onclick = ()=>{
  playerName = document.getElementById("playerName").value.trim();
  room = document.getElementById("room").value.trim();
  if(!playerName || !room){
    alert("Digite nome e sala!");
    return;
  }
  setupDiv.style.display="none";
  seriesSelectDiv.style.display="flex";
};

backToSetupBtn.onclick = ()=>{
  seriesSelectDiv.style.display="none";
  setupDiv.style.display="flex";
};

startGameBtn.onclick = ()=>{
  if(!selectedSeries){
    alert("Escolha a s√©rie!");
    return;
  }
  seriesSelectDiv.style.display="none";
  gameContainer.style.display="flex";
  startSnakeGame();
};

exitBtn.onclick = exitToSetup;
exitToSetupBtn.onclick = exitToSetup;
retryBtn.onclick = startSnakeGame;

function exitToSetup(){
  gameContainer.style.display="none";
  gameOverDiv.style.display="none";
  setupDiv.style.display="flex";
  selectedSeries=null;
  document.querySelectorAll(".seriesButton").forEach(b=>b.classList.remove("selected"));
}

// JOGO
function startSnakeGame(){
  snake = [{x:10,y:10}];
  direction = "RIGHT";
  food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
  clearInterval(gameInterval);
  gameInterval = setInterval(gameLoop, 150);
  gameOverDiv.style.display="none";
  gameContainer.style.display="flex";
  drawGame();
}

// FUN√á√ÉO PRINCIPAL
function gameLoop(){
  const head = {...snake[0]};
  if(direction=="RIGHT") head.x++;
  if(direction=="LEFT") head.x--;
  if(direction=="UP") head.y--;
  if(direction=="DOWN") head.y++;
  
  if(head.x<0 || head.x>=20 || head.y<0 || head.y>=20 || snake.some(s=>s.x==head.x && s.y==head.y)){
    clearInterval(gameInterval);
    gameContainer.style.display="none";
    gameOverDiv.style.display="flex";
    return;
  }
  
  snake.unshift(head);
  if(head.x==food.x && head.y==food.y){
    eatSound.play();
    food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
    saveScore();
  }else{
    snake.pop();
  }
  
  drawGame();
}

function drawGame(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="red";
  ctx.fillRect(food.x*20, food.y*20, 20,20);
  ctx.fillStyle="#0f0";
  snake.forEach(s=>{
    ctx.fillRect(s.x*20,s.y*20,20,20);
  });
}

document.addEventListener("keydown", e=>{
  if(e.key=="ArrowUp" && direction!="DOWN") direction="UP";
  if(e.key=="ArrowDown" && direction!="UP") direction="DOWN";
  if(e.key=="ArrowLeft" && direction!="RIGHT") direction="LEFT";
  if(e.key=="ArrowRight" && direction!="LEFT") direction="RIGHT";
});

// LEADERBOARD
function saveScore(){
  const key = "snakeLeaderboard";
  let lb = JSON.parse(localStorage.getItem(key)||"[]");
  const score = snake.length-1;
  const existIndex = lb.findIndex(e=>e.name==playerName && e.series==selectedSeries && e.room==room);
  if(existIndex>=0){
    lb[existIndex].score = score;
  }else{
    lb.push({name:playerName, series:selectedSeries, room:room, score:score});
  }
  lb.sort((a,b)=>b.score - a.score);
  if(lb.length>10) lb=lb.slice(0,10);
  localStorage.setItem(key, JSON.stringify(lb));
  updateLeaderboard();
}

function updateLeaderboard(){
  const key = "snakeLeaderboard";
  let lb = JSON.parse(localStorage.getItem(key)||"[]");
  leaderboardBody.innerHTML="";
  lb.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td><td>${p.score}</td><td>${p.series}</td>`;
    leaderboardBody.appendChild(tr);
  });
}

updateLeaderboard();
</script>
</body>
</html>
