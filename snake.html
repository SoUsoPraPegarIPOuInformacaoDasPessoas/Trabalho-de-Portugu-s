<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo da Cobrinha</title>
<style>
:root{
  --bg:#000;
  --green:#0f0;
  --white:#fff;
  --orange:#f77f00;
  --blue:#00f;
}
body{
  margin:0;
  font-family: "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--white);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
}
h1{
  color: var(--green);
  font-size:3rem;
  text-align:center;
  text-shadow: 2px 2px var(--white);
  margin-top:10px;
  animation: pulse 2s infinite;
}
@keyframes pulse{
  0%,100%{text-shadow: 2px 2px var(--white);}
  50%{text-shadow: 4px 4px var(--green);}
}
canvas{
  background:#111;
  margin-top:20px;
  border:4px solid var(--white);
}
.button{
  padding:10px 20px;
  margin:8px;
  border-radius:12px;
  background:linear-gradient(90deg,var(--green),var(--orange));
  color:#000;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
  border:2px solid var(--white);
  font-size:1rem;
}
.button:hover{
  transform: translateY(-3px);
  box-shadow:0 6px 20px var(--green);
}
#modeSelection, #soloSetup, #versusSetup, #gameOver{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  margin-top:20px;
}
#leaderboard{
  margin-left:20px;
  padding:10px;
  border:3px solid var(--blue);
  background:#111;
  color:var(--white);
}
input{
  padding:6px;
  margin:6px;
  border-radius:8px;
  border:none;
  font-size:1rem;
}
#gameContainer{
  display:flex;
  flex-direction:row;
  align-items:flex-start;
}
</style>
</head>
<body>

<h1>Jogo da Cobrinha üêç</h1>

<div id="modeSelection">
  <button class="button" id="soloBtn">Solo</button>
  <button class="button" id="versusBtn">1 vs 1</button>
</div>

<div id="soloSetup" style="display:none;">
  <input type="text" id="soloName" placeholder="Seu nome">
  <input type="text" id="soloRoom" placeholder="Sala">
  <button class="button" id="startSolo">JOGAR üü¢</button>
  <button class="button" id="backFromSolo">Voltar</button>
</div>

<div id="versusSetup" style="display:none;">
  <input type="text" id="p1Name" placeholder="Nome jogador 1">
  <input type="text" id="p2Name" placeholder="Nome jogador 2">
  <input type="text" id="versusRoom" placeholder="Sala">
  <button class="button" id="startVersus">JOGAR üü¢</button>
  <button class="button" id="backFromVersus">Voltar</button>
</div>

<div id="gameContainer" style="display:none;">
  <canvas id="gameCanvas" width="500" height="500"></canvas>
  <div id="leaderboard">
    <h3>Leaderboard</h3>
    <ul id="scoresList"></ul>
  </div>
</div>

<div id="gameOver" style="display:none;">
  <h2 id="gameOverText"></h2>
  <button class="button" id="restartBtn">Recome√ßar</button>
  <button class="button" id="exitBtn">Sair do Minigame</button>
</div>

<a href="index.html" class="button">Voltar para a p√°gina inicial</a>

<audio id="eatSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
<audio id="moveSound" src="https://www.soundjay.com/button/beep-05.wav"></audio>

<script>
// vari√°veis gerais
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");
let tile = 20;
let gameInterval;
let leaderboard = JSON.parse(localStorage.getItem("snakeLeaderboard")) || [];
let gameMode = null; // 'solo' ou 'versus'
let snake, food, direction, score, alive, player1, player2;

// sons
let eatSound = document.getElementById("eatSound");
let moveSound = document.getElementById("moveSound");

// DOM
let modeSelection = document.getElementById("modeSelection");
let soloSetup = document.getElementById("soloSetup");
let versusSetup = document.getElementById("versusSetup");
let gameContainer = document.getElementById("gameContainer");
let gameOverDiv = document.getElementById("gameOver");
let gameOverText = document.getElementById("gameOverText");
let scoresList = document.getElementById("scoresList");

// BOT√ïES
document.getElementById("soloBtn").onclick = ()=>{
    modeSelection.style.display = "none";
    soloSetup.style.display = "flex";
}
document.getElementById("versusBtn").onclick = ()=>{
    modeSelection.style.display = "none";
    versusSetup.style.display = "flex";
}
document.getElementById("backFromSolo").onclick = ()=>{
    soloSetup.style.display="none";
    modeSelection.style.display="flex";
}
document.getElementById("backFromVersus").onclick = ()=>{
    versusSetup.style.display="none";
    modeSelection.style.display="flex";
}
document.getElementById("exitBtn").onclick = ()=>{
    gameOverDiv.style.display="none";
    gameContainer.style.display="none";
    if(gameMode=="solo") soloSetup.style.display="flex";
    else if(gameMode=="versus") versusSetup.style.display="flex";
    clearInterval(gameInterval);
}

// START SOLO
document.getElementById("startSolo").onclick = ()=>{
    let name = document.getElementById("soloName").value.trim();
    let room = document.getElementById("soloRoom").value.trim();
    if(!name || !room){alert("Preencha nome e sala!"); return;}
    gameMode = "solo";
    startGameSolo(name);
}

// START VERSUS
document.getElementById("startVersus").onclick = ()=>{
    let p1 = document.getElementById("p1Name").value.trim();
    let p2 = document.getElementById("p2Name").value.trim();
    let room = document.getElementById("versusRoom").value.trim();
    if(!p1 || !p2 || !room){alert("Preencha todos os campos!"); return;}
    gameMode="versus";
    startGameVersus(p1,p2);
}

// Fun√ß√µes gerais
function getRandomCoord(max){return Math.floor(Math.random()*max)*tile;}
function drawRect(x,y,color){ctx.fillStyle=color; ctx.fillRect(x,y,tile,tile);}
function updateLeaderboard(name,score){
    leaderboard.push({name,score});
    leaderboard.sort((a,b)=>b.score-a.score);
    if(leaderboard.length>10) leaderboard.pop();
    localStorage.setItem("snakeLeaderboard",JSON.stringify(leaderboard));
    renderLeaderboard();
}
function renderLeaderboard(){
    scoresList.innerHTML="";
    leaderboard.forEach(p=>{
        let li=document.createElement("li");
        li.textContent=p.name+" - "+p.score;
        scoresList.appendChild(li);
    });
}

// --- SOLO ---
function startGameSolo(playerName){
    soloSetup.style.display="none";
    gameContainer.style.display="flex";
    snake=[{x:10*tile,y:10*tile}];
    direction="RIGHT";
    food={x:getRandomCoord(canvas.width/tile),y:getRandomCoord(canvas.height/tile)};
    score=0;
    alive=true;
    document.addEventListener("keydown",keyDownSolo);
    gameInterval=setInterval(updateSolo,100);
}

function keyDownSolo(e){
    moveSound.play();
    if(e.key==="ArrowUp" && direction!="DOWN") direction="UP";
    else if(e.key==="ArrowDown" && direction!="UP") direction="DOWN";
    else if(e.key==="ArrowLeft" && direction!="RIGHT") direction="LEFT";
    else if(e.key==="ArrowRight" && direction!="LEFT") direction="RIGHT";
}

function updateSolo(){
    if(!alive) return;
    let head={x:snake[0].x,y:snake[0].y};
    if(direction==="UP") head.y-=tile;
    else if(direction==="DOWN") head.y+=tile;
    else if(direction==="LEFT") head.x-=tile;
    else if(direction==="RIGHT") head.x+=tile;

    // colis√£o paredes ou corpo
    if(head.x<0 || head.x>=canvas.width || head.y<0 || head.y>=canvas.height || snake.some(s=>s.x===head.x && s.y===head.y)){
        alive=false; gameOverSolo(); return;
    }

    snake.unshift(head);

    // comida
    if(head.x===food.x && head.y===food.y){
        score++;
        eatSound.play();
        food={x:getRandomCoord(canvas.width/tile),y:getRandomCoord(canvas.height/tile)};
    }else snake.pop();

    drawGameSolo();
}

function drawGameSolo(){
    ctx.fillStyle="#111";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    snake.forEach((s,i)=>drawRect(s.x,s.y,i===0?var(--green):"#0f0"));
    drawRect(food.x,food.y,"#f00");
}

// GAME OVER SOLO
function gameOverSolo(){
    gameContainer.style.display="none";
    gameOverDiv.style.display="flex";
    gameOverText.textContent="VOC√ä MORREU!";
    document.getElementById("restartBtn").onclick = ()=>{
        gameOverDiv.style.display="none";
        startGameSolo(document.getElementById("soloName").value);
    }
}

// --- VERSUS ---
function startGameVersus(name1,name2){
    versusSetup.style.display="none";
    gameContainer.style.display="flex";
    // por enquanto implementamos apenas base; full 1vs1 pode ser expandido
    snake=[{x:10*tile,y:10*tile},{x:15*tile,y:15*tile}];
    direction="RIGHT"; // jogador 1 e 2 controles W A S D + setas
    alive=true;
    document.addEventListener("keydown",keyDownVersus);
    gameInterval=setInterval(updateVersus,100);
}

function keyDownVersus(e){
    moveSound.play();
    // Implementar controles W A S D para jogador 1 e setas para jogador 2
}

// fun√ß√£o placeholder
function updateVersus(){
    ctx.fillStyle="#111";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    // placeholder: voc√™ ver√° apenas o canvas preto, depois implementa 1vs1 real
}
</script>

</body>
</html>
