<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo da Cobrinha</title>
<style>
  body { 
    margin:0; 
    font-family: Arial, sans-serif; 
    background-color:black; 
    color:#00ff00; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
  }
  h1 { 
    font-size:3rem; 
    border:2px solid white; 
    padding:12px; 
    margin:20px; 
    text-align:center; 
  }
  #menu { display:flex; gap:20px; margin-top:40px;}
  .btn { 
    background:#00ccff; 
    color:white; 
    padding:12px 24px; 
    border-radius:10px; 
    font-size:1.2rem; 
    cursor:pointer; 
    font-weight:bold; 
    transition:0.2s; 
  }
  .btn:hover { background:#0099cc; }
  #gameContainer { display:none; flex-direction:row; gap:20px; margin-top:20px; }
  #soloGame, #vsGame { background:#111; padding:12px; border-radius:10px; }
  canvas { background:black; display:block; margin:auto; }
  #controls { margin-top:10px; display:flex; gap:12px; justify-content:center; }
  input { padding:6px; border-radius:6px; border:none; font-size:1rem; }
  #leaderboard { background:#222; color:white; padding:12px; border-radius:10px; max-height:400px; overflow-y:auto; min-width:200px; }
  #gameOverScreen { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:red; color:white; font-size:3rem; display:flex; flex-direction:column; align-items:center; justify-content:center; }
  #gameOverScreen button { margin-top:12px; padding:12px 20px; font-size:1.2rem; }
</style>
</head>
<body>

<h1>Jogo da Cobrinha</h1>

<div id="menu">
  <button class="btn" id="soloBtn">Solo</button>
  <button class="btn" id="vsBtn">1 vs 1</button>
</div>

<div id="soloInputs" style="display:none; flex-direction:column; align-items:center; gap:12px; margin-top:20px;">
  <input type="text" id="soloName" placeholder="Digite seu nome">
  <input type="text" id="soloRoom" placeholder="Digite a sala">
  <button class="btn" id="soloStart">JOGAR</button>
  <button class="btn" id="soloCancel">Cancelar</button>
</div>

<div id="vsInputs" style="display:none; flex-direction:column; align-items:center; gap:12px; margin-top:20px;">
  <input type="text" id="vsName1" placeholder="Nome jogador 1">
  <input type="text" id="vsName2" placeholder="Nome jogador 2">
  <input type="text" id="vsRoom" placeholder="Digite a sala">
  <button class="btn" id="vsStart">JOGAR</button>
  <button class="btn" id="vsCancel">Cancelar</button>
</div>

<div id="gameContainer">
  <div id="soloGame">
    <canvas id="soloCanvas" width="400" height="400"></canvas>
    <div id="controls"></div>
  </div>
  <div id="vsGame">
    <div style="display:flex; gap:20px;">
      <div>
        <h3 style="color:white; text-align:center;" id="vsName1Title"></h3>
        <canvas id="vsCanvas1" width="200" height="200"></canvas>
      </div>
      <div>
        <h3 style="color:white; text-align:center;" id="vsName2Title"></h3>
        <canvas id="vsCanvas2" width="200" height="200"></canvas>
      </div>
    </div>
  </div>
  <div id="leaderboard">
    <h3>Leaderboard</h3>
    <ul id="leaderboardList"></ul>
  </div>
</div>

<div id="gameOverScreen">
  <div id="gameOverText"></div>
  <button id="restartBtn">Recomeçar</button>
  <button id="exitBtn">Sair do minigame</button>
</div>

<audio id="eatSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
<audio id="moveSound" src="https://www.soundjay.com/button/beep-05.wav"></audio>

<script>
// ======== Menu e Inputs ==========
const menu = document.getElementById('menu');
const soloBtn = document.getElementById('soloBtn');
const vsBtn = document.getElementById('vsBtn');
const soloInputs = document.getElementById('soloInputs');
const vsInputs = document.getElementById('vsInputs');
const soloStart = document.getElementById('soloStart');
const vsStart = document.getElementById('vsStart');
const soloCancel = document.getElementById('soloCancel');
const vsCancel = document.getElementById('vsCancel');

soloBtn.onclick = ()=>{ menu.style.display='none'; soloInputs.style.display='flex'; };
vsBtn.onclick = ()=>{ menu.style.display='none'; vsInputs.style.display='flex'; };

soloCancel.onclick = ()=>{
  soloInputs.style.display='none'; menu.style.display='flex';
};
vsCancel.onclick = ()=>{
  vsInputs.style.display='none'; menu.style.display='flex';
};

// ======== Leaderboard ==========
let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
const leaderboardList = document.getElementById('leaderboardList');
function updateLeaderboard(){
  leaderboardList.innerHTML = '';
  leaderboard.forEach(item=>{
    const li = document.createElement('li');
    li.textContent = `${item.name} (${item.room}): ${item.score}`;
    leaderboardList.appendChild(li);
  });
}

// ======== Solo Game ==========
const soloCanvas = document.getElementById('soloCanvas');
const ctxSolo = soloCanvas.getContext('2d');
let soloInterval;
let soloSnake, soloApple, soloDir, soloScore;
const eatSound = document.getElementById('eatSound');
const moveSound = document.getElementById('moveSound');
const gameOverScreen = document.getElementById('gameOverScreen');
const gameOverText = document.getElementById('gameOverText');
const restartBtn = document.getElementById('restartBtn');
const exitBtn = document.getElementById('exitBtn');

soloStart.onclick = ()=>{
  const name = document.getElementById('soloName').value.trim();
  const room = document.getElementById('soloRoom').value.trim();
  if(!name || !room){ alert('Preencha todas as informações!'); return; }
  startSolo(name, room);
};

restartBtn.onclick = ()=>{
  gameOverScreen.style.display='none';
  if(currentMode==='solo') startSolo(currentPlayer,currentRoom);
};
exitBtn.onclick = ()=>{
  gameOverScreen.style.display='none';
  menu.style.display='flex';
  document.getElementById('gameContainer').style.display='none';
};

let currentMode='', currentPlayer='', currentRoom='';

function startSolo(name, room){
  currentMode='solo';
  currentPlayer=name;
  currentRoom=room;
  soloInputs.style.display='none';
  document.getElementById('gameContainer').style.display='flex';
  soloSnake=[{x:10,y:10}];
  soloDir={x:1,y:0};
  soloScore=0;
  spawnApple();
  clearInterval(soloInterval);
  soloInterval=setInterval(updateSoloGame,150);
  updateLeaderboard();
}

function spawnApple(){
  soloApple={
    x: Math.floor(Math.random()*20),
    y: Math.floor(Math.random()*20)
  };
}

document.addEventListener('keydown',(e)=>{
  moveSound.play();
  if(currentMode==='solo'){
    switch(e.key){
      case 'ArrowUp': if(soloDir.y!==1) soloDir={x:0,y:-1}; break;
      case 'ArrowDown': if(soloDir.y!==-1) soloDir={x:0,y:1}; break;
      case 'ArrowLeft': if(soloDir.x!==1) soloDir={x:-1,y:0}; break;
      case 'ArrowRight': if(soloDir.x!==-1) soloDir={x:1,y:0}; break;
    }
  }
});

function updateSoloGame(){
  const head={x:soloSnake[0].x+soloDir.x, y:soloSnake[0].y+soloDir.y};
  if(head.x<0||head.y<0||head.x>=20||head.y>=20||soloSnake.some(s=>s.x===head.x && s.y===head.y)){
    gameOver('VOCÊ MORREU!');
    return;
  }
  soloSnake.unshift(head);
  if(head.x===soloApple.x && head.y===soloApple.y){
    eatSound.play();
    soloScore+=10;
    spawnApple();
  } else { soloSnake.pop(); }
  drawSolo();
}

function drawSolo(){
  ctxSolo.fillStyle='black';
  ctxSolo.fillRect(0,0,soloCanvas.width,soloCanvas.height);
  ctxSolo.fillStyle='lime';
  soloSnake.forEach(s=>ctxSolo.fillRect(s.x*20,s.y*20,20,20));
  ctxSolo.fillStyle='red';
  ctxSolo.fillRect(soloApple.x*20,soloApple.y*20,20,20);
}

function gameOver(text){
  gameOverText.textContent=text;
  gameOverScreen.style.display='flex';
  leaderboard.push({name:currentPlayer,room:currentRoom,score:soloScore});
  localStorage.setItem('leaderboard',JSON.stringify(leaderboard));
  updateLeaderboard();
}
</script>
</body>
</html>
