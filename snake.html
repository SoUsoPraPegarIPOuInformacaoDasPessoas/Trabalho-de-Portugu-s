<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo da Cobrinha - Solo</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background-color: #000;
  color: #fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 {
  font-size:3rem;
  color:#00ff00;
  margin:20px 0;
  border:4px solid #fff;
  padding:10px 20px;
  border-radius:12px;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.05);}
}
#topButtons {
  display:flex;
  gap:15px;
  margin-top:10px;
}
#topButtons button {
  padding:8px 16px;
  border-radius:8px;
  border:2px solid #fff;
  background:#111;
  color:#0f0;
  cursor:pointer;
  font-weight:bold;
}
#topButtons button:hover{background:#222;}
#setup, #gameContainer, #gameOver {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
label {margin:5px;}
button {
  padding:10px 20px;
  margin:5px;
  border-radius:10px;
  border:2px solid #fff;
  background:#111;
  color:#0f0;
  cursor:pointer;
  font-weight:bold;
}
button:hover {background:#222;}
canvas {
  border:3px solid #fff;
  background:#000;
  display:block;
  margin-top:20px;
}
#leaderboard {
  margin-top:20px;
  border:3px solid #fff;
  background:#111;
  padding:10px;
  border-radius:10px;
  width:400px;
}
#leaderboard table {
  width:100%;
  border-collapse: collapse;
}
#leaderboard th, #leaderboard td {
  border:1px solid #fff;
  padding:5px;
  text-align:center;
}
#leaderboard th {
  background:#222;
}
</style>
</head>
<body>

<h1>Jogo da Cobrinha</h1>

<div id="topButtons">
  <button onclick="window.location.href='index.html'">P√°gina Inicial</button>
  <button onclick="window.location.href='processo.html'">Processo</button>
  <button onclick="window.location.href='pagina2.html'">P√°gina 2</button>
</div>

<div id="setup">
  <label>Nome:</label>
  <input type="text" id="playerName" placeholder="Digite seu nome">
  
  <label>S√©rie:</label>
  <div id="seriesOptions"></div>
  
  <label>Sala:</label>
  <input type="text" id="room" placeholder="Digite sua sala">
  
  <button id="startBtn">Jogar Solo üêç</button>
</div>

<div id="gameContainer" style="display:none;">
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <div>
    <button id="restartBtn">Recome√ßar</button>
    <button id="exitBtn">Sair do minigame</button>
  </div>
</div>

<div id="gameOver" style="display:none;">
  <h2>Voc√™ Morreu!</h2>
  <button id="retryBtn">Recome√ßar</button>
  <button id="exitToSetupBtn">Sair do minigame</button>
</div>

<div id="leaderboard">
  <h3>Leaderboard Top 10</h3>
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Pontua√ß√£o</th>
        <th>S√©rie</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody"></tbody>
  </table>
</div>

<audio id="eatSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>

<script>
// SERIES DINAMICAS
const seriesList = ["1¬∫A","1¬∫B","2¬∫A","2¬∫B","3¬∫A","3¬∫B","4¬∫A","4¬∫B","5¬∫A","5¬∫B","6¬∫A","6¬∫B","7¬∫A","7¬∫B","8¬∫A","8¬∫B","9¬∫A","9¬∫B"];
const seriesDiv = document.getElementById("seriesOptions");
let selectedSeries = null;

seriesList.forEach(s => {
  const btn = document.createElement("button");
  btn.textContent = s;
  btn.onclick = () => {
    selectedSeries = s;
    Array.from(seriesDiv.children).forEach(b => b.style.background = "#111");
    btn.style.background = "#0f0";
  };
  seriesDiv.appendChild(btn);
});

// ELEMENTOS
const setupDiv = document.getElementById("setup");
const startBtn = document.getElementById("startBtn");
const gameContainer = document.getElementById("gameContainer");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let snake, food, direction, gameInterval, playerName, room;

const gameOverDiv = document.getElementById("gameOver");
const retryBtn = document.getElementById("retryBtn");
const exitToSetupBtn = document.getElementById("exitToSetupBtn");

const restartBtn = document.getElementById("restartBtn");
const exitBtn = document.getElementById("exitBtn");

const leaderboardBody = document.getElementById("leaderboardBody");

const eatSound = document.getElementById("eatSound");

// START DO JOGO
startBtn.onclick = () => {
  playerName = document.getElementById("playerName").value.trim();
  room = document.getElementById("room").value.trim();
  
  if(!playerName || !room || !selectedSeries){
    alert("Preencha nome, s√©rie e sala!");
    return;
  }
  
  setupDiv.style.display = "none";
  gameContainer.style.display = "flex";
  
  startGame();
};

restartBtn.onclick = () => startGame();
retryBtn.onclick = () => startGame();

exitBtn.onclick = exitToSetup;
exitToSetupBtn.onclick = exitToSetup;

function exitToSetup(){
  gameContainer.style.display = "none";
  gameOverDiv.style.display = "none";
  setupDiv.style.display = "flex";
}

function startGame(){
  gameOverDiv.style.display = "none";
  snake = [{x:10,y:10}];
  direction = "RIGHT";
  food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
  clearInterval(gameInterval);
  gameInterval = setInterval(gameLoop, 150);
  drawGame();
}

function gameLoop(){
  const head = {...snake[0]};
  if(direction=="RIGHT") head.x++;
  if(direction=="LEFT") head.x--;
  if(direction=="UP") head.y--;
  if(direction=="DOWN") head.y++;
  
  if(head.x<0 || head.x>=20 || head.y<0 || head.y>=20 || snake.some(s=>s.x==head.x && s.y==head.y)){
    gameOver();
    return;
  }
  
  snake.unshift(head);
  
  if(head.x==food.x && head.y==food.y){
    eatSound.play();
    food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
    saveScore();
  }else{
    snake.pop();
  }
  
  drawGame();
}

function drawGame(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  
  ctx.fillStyle="red";
  ctx.fillRect(food.x*20, food.y*20, 20,20);
  
  ctx.fillStyle="#0f0";
  snake.forEach(s=>{
    ctx.fillRect(s.x*20,s.y*20,20,20);
  });
}

document.addEventListener("keydown", e=>{
  if(e.key=="ArrowUp" && direction!="DOWN") direction="UP";
  if(e.key=="ArrowDown" && direction!="UP") direction="DOWN";
  if(e.key=="ArrowLeft" && direction!="RIGHT") direction="LEFT";
  if(e.key=="ArrowRight" && direction!="LEFT") direction="RIGHT";
});

function gameOver(){
  clearInterval(gameInterval);
  gameContainer.style.display="none";
  gameOverDiv.style.display="flex";
}

// SALVA SCORE COM NOME, PONTUA√á√ÉO E S√âRIE
function saveScore(){
  const key = "snakeLeaderboard";
  let lb = JSON.parse(localStorage.getItem(key)||"[]");
  
  const fullName = playerName;
  const existIndex = lb.findIndex(e=>e.name==fullName && e.series==selectedSeries && e.room==room);
  
  const score = snake.length-1;
  if(existIndex>=0){
    lb[existIndex].score = score;
  }else{
    lb.push({name:fullName, series:selectedSeries, room:room, score:score});
  }
  
  lb.sort((a,b)=>b.score - a.score);
  if(lb.length>10) lb = lb.slice(0,10);
  
  localStorage.setItem(key, JSON.stringify(lb));
  updateLeaderboard();
}

// ATUALIZA A TABELA
function updateLeaderboard(){
  const key = "snakeLeaderboard";
  let lb = JSON.parse(localStorage.getItem(key)||"[]");
  leaderboardBody.innerHTML="";
  lb.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td><td>${p.score}</td><td>${p.series}</td>`;
    leaderboardBody.appendChild(tr);
  });
}

updateLeaderboard();
</script>

</body>
</html>
