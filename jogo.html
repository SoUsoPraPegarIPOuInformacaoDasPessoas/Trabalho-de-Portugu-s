<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo da Cobrinha — Menino da Canoa</title>
<style>
  :root{
    --green:#28a745;
    --red:#d62828;
    --blue:#1e90ff;
    --orange:#f77f00;
    --bg:#f0f0f0;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family:"Segoe UI", Roboto, Arial, sans-serif;
    background:var(--bg);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding-top:20px;
  }
  h1{text-align:center;color:var(--blue);}
  #entrada{
    margin-bottom:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }
  input{
    padding:10px;
    border-radius:8px;
    border:2px solid #aaa;
    width:180px;
    text-align:center;
  }
  #jogar{
    padding:10px 20px;
    background:var(--green);
    color:white;
    border:none;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
  }
  #jogar:hover{transform:translateY(-2px);}
  canvas{
    background:#111;
    display:block;
    margin-top:20px;
    border:4px solid var(--blue);
  }
  #tabelaBtn{
    margin-top:10px;
    padding:8px 16px;
    background:var(--blue);
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
  }
  #tabelaFrame{
    position:absolute;
    top:20px;
    right:20px;
    width:220px;
    max-height:400px;
    background:var(--orange);
    border:3px solid var(--blue);
    border-radius:10px;
    padding:10px;
    overflow-y:auto;
    display:none;
  }
  #tabelaFrame h3{text-align:center;margin:0 0 10px;}
  #tabelaFrame ul{list-style:none;padding:0;margin:0;}
  #tabelaFrame li{margin:4px 0;}
  #gameOver{
    display:none;
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:var(--red);
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-size:1.5rem;
  }
  #restart{
    margin-top:20px;
    padding:10px 20px;
    background:var(--green);
    border:none;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
  }
</style>
</head>
<body>

<h1>Jogo da Cobrinha — Menino da Canoa</h1>

<div id="entrada">
  <input type="text" id="playerName" placeholder="Seu nome">
  <input type="text" id="playerRoom" placeholder="Sua sala">
  <button id="jogar">JOGAR</button>
</div>

<button id="tabelaBtn">Tabela</button>
<div id="tabelaFrame">
  <h3>Leaderboard</h3>
  <ul id="leaderboard"></ul>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<div id="gameOver">
  <div id="gameOverText">VOCÊ MORREU!</div>
  <div id="finalScore"></div>
  <button id="restart">Recomeçar</button>
</div>

<a href="processo.html" class="btn" style="margin-top:30px;">Voltar para Processo</a>

<audio id="comerSom">
  <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
</audio>

<script>
  const canvas=document.getElementById('gameCanvas');
  const ctx=canvas.getContext('2d');
  let snake=[], direction, apple, score, gameInterval, isGameRunning=false;
  const grid=20;

  const playerNameInput=document.getElementById('playerName');
  const playerRoomInput=document.getElementById('playerRoom');
  const jogarBtn=document.getElementById('jogar');
  const tabelaBtn=document.getElementById('tabelaBtn');
  const tabelaFrame=document.getElementById('tabelaFrame');
  const gameOverDiv=document.getElementById('gameOver');
  const finalScoreDiv=document.getElementById('finalScore');
  const restartBtn=document.getElementById('restart');
  const comerSom=document.getElementById('comerSom');

  // Carregar leaderboard do localStorage
  let leaderboard = JSON.parse(localStorage.getItem('snakeLeaderboard')) || [];

  function saveLeaderboard(){
    localStorage.setItem('snakeLeaderboard', JSON.stringify(leaderboard));
  }

  function resetGame(){
    snake=[{x:8,y:8}];
    direction='RIGHT';
    apple=randomPosition();
    score=0;
    isGameRunning=false;
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }

  function randomPosition(){
    return {x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*20)};
  }

  function draw(){
    ctx.fillStyle='#111';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle='red';
    ctx.fillRect(apple.x*grid,apple.y*grid,grid,grid);

    ctx.fillStyle='lime';
    snake.forEach((s)=>ctx.fillRect(s.x*grid,s.y*grid,grid-1,grid-1));
  }

  function update(){
    const head={...snake[0]};
    if(direction==='LEFT') head.x--;
    if(direction==='RIGHT') head.x++;
    if(direction==='UP') head.y--;
    if(direction==='DOWN') head.y++;

    if(head.x<0 || head.x>=canvas.width/grid || head.y<0 || head.y>=canvas.height/grid || snake.some(s=>s.x===head.x && s.y===head.y)){
      gameOver();
      return;
    }

    snake.unshift(head);

    if(head.x===apple.x && head.y===apple.y){
      score++;
      comerSom.play();
      apple=randomPosition();
    }else{
      snake.pop();
    }

    draw();
  }

  function gameOver(){
    isGameRunning=false;
    clearInterval(gameInterval);
    finalScoreDiv.innerHTML=`${playerNameInput.value} - Pontos: ${score}`;
    gameOverDiv.style.display='flex';
    leaderboard.push({name:playerNameInput.value, room:playerRoomInput.value, score:score});
    saveLeaderboard();
    updateLeaderboard();
  }

  function updateLeaderboard(){
    const ul=document.getElementById('leaderboard');
    ul.innerHTML='';
    leaderboard.sort((a,b)=>b.score-a.score);
    leaderboard.forEach(item=>{
      const li=document.createElement('li');
      li.textContent=`${item.name} | Sala: ${item.room} | Pontos: ${item.score}`;
      ul.appendChild(li);
    });
  }

  function startGame(){
    if(playerNameInput.value.trim()==='' || playerRoomInput.value.trim()===''){
      alert('Digite nome e sala para jogar!');
      return;
    }
    resetGame();
    isGameRunning=true;
    gameInterval=setInterval(update,150);
    document.getElementById('entrada').style.display='none';
  }

  document.addEventListener('keydown',(e)=>{
    if(!isGameRunning && e.code==='Space'){
      startGame();
    }
    if(e.code==='ArrowUp' && direction!=='DOWN') direction='UP';
    if(e.code==='ArrowDown' && direction!=='UP') direction='DOWN';
    if(e.code==='ArrowLeft' && direction!=='RIGHT') direction='LEFT';
    if(e.code==='ArrowRight' && direction!=='LEFT') direction='RIGHT';
  });

  jogarBtn.addEventListener('click',()=>{startGame();});
  restartBtn.addEventListener('click',()=>{
    gameOverDiv.style.display='none';
    document.getElementById('entrada').style.display='flex';
    playerNameInput.value='';
    playerRoomInput.value='';
  });

  tabelaBtn.addEventListener('click',()=>{
    if(tabelaFrame.style.display==='none'){
      tabelaFrame.style.display='block';
      tabelaFrame.style.transform='translateY(-20px)';
      setTimeout(()=>{tabelaFrame.style.transform='translateY(0)';},50);
    }else{
      tabelaFrame.style.display='none';
    }
  });

  // Mostrar leaderboard quando abrir a página
  updateLeaderboard();

</script>
</body>
</html>
