<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game ‚Äî Bacon News</title>
<style>
  body { margin:0; font-family: "Segoe UI", Roboto, Arial, sans-serif; background:#f0f0f0; display:flex; justify-content:center; align-items:center; height:100vh; }
  #container { text-align:center; position:relative; }
  #startScreen, #gameScreen, #gameOverScreen { display:none; }
  #gameCanvas { background:#0a1f44; display:block; margin:0 auto; border:4px solid #89cff0; border-radius:12px; }
  input { padding:10px; margin:6px; border-radius:8px; border:2px solid #0077ff; width:180px; font-size:1rem; }
  button { padding:10px 18px; font-size:1rem; border:none; border-radius:10px; cursor:pointer; font-weight:700; margin:5px; transition:all 0.2s; }
  #tabelaBtn { background:linear-gradient(90deg,#ffc107,#ff6f00); color:white; }
  #tabelaBtn:hover { transform: scale(1.2); box-shadow:0 8px 20px rgba(0,0,0,0.3);}
  #jogar, #restart { background:linear-gradient(90deg,#28a745,#71dd8a); color:white; }
  #jogar:hover, #restart:hover { transform: scale(1.1); box-shadow:0 8px 20px rgba(0,0,0,0.3);}
  #tabelaFrame { position:absolute; top:0; left:50%; transform:translateX(-50%) translateY(-400px); width:300px; background:#ffa500; border:4px solid #0077ff; padding:10px; border-radius:12px; transition: transform 0.5s; }
  #tabelaFrame.show { transform:translateX(-50%) translateY(60px); }
  #tabelaFrame h3 { margin-top:0; text-align:center; }
  #tabelaFrame ul { list-style:none; padding:0; margin:0; }
</style>
</head>
<body>

<div id="container">

  <!-- Tela Inicial -->
  <div id="startScreen">
    <h2>üêç Jogo da Cobrinha</h2>
    <input type="text" id="playerName" placeholder="Seu nome (ex: Matheus123)">
    <input type="text" id="playerRoom" placeholder="Sala (ex: 8A)">
    <br>
    <button id="jogar">JOGAR ‚ñ∂Ô∏è</button>
  </div>

  <!-- Tela do Jogo -->
  <div id="gameScreen">
    <canvas id="gameCanvas" width="500" height="500"></canvas>
    <br>
    <button id="tabelaBtn">üìä Tabela</button>
  </div>

  <!-- Tela de Morte -->
  <div id="gameOverScreen">
    <h2 style="color:red;">üíÄ VOC√ä MORREU! üíÄ</h2>
    <p id="finalScore"></p>
    <button id="restart">üîÑ RECOME√áAR</button>
  </div>

  <!-- Leaderboard -->
  <div id="tabelaFrame">
    <h3>üèÜ Leaderboard</h3>
    <ul id="scoreList"></ul>
  </div>

</div>

<!-- Sons -->
<audio id="appleSound"><source src="https://www.soundjay.com/button/sounds/button-10.mp3" type="audio/mpeg"></audio>
<audio id="buttonClickSound"><source src="https://www.soundjay.com/button/sounds/button-09.mp3" type="audio/mpeg"></audio>

<script>
  // DOM Elements
  const startScreen = document.getElementById('startScreen');
  const gameScreen = document.getElementById('gameScreen');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const jogarBtn = document.getElementById('jogar');
  const restartBtn = document.getElementById('restart');
  const tabelaBtn = document.getElementById('tabelaBtn');
  const tabelaFrame = document.getElementById('tabelaFrame');
  const scoreList = document.getElementById('scoreList');
  const finalScore = document.getElementById('finalScore');
  const appleSound = document.getElementById('appleSound');
  const buttonClickSound = document.getElementById('buttonClickSound');

  let playerName = '';
  let playerRoom = '';
  let canvas, ctx;
  let snake, direction, apple, score;
  let gameInterval;
  let leaderboard = JSON.parse(localStorage.getItem('snakeLeaderboard') || '[]');

  // Start Game
  jogarBtn.addEventListener('click', () => {
    buttonClickSound.play();
    playerName = document.getElementById('playerName').value || 'Jogador';
    playerRoom = document.getElementById('playerRoom').value || 'Sala1';
    startScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    initGame();
  });

  // Restart Game
  restartBtn.addEventListener('click', () => {
    buttonClickSound.play();
    gameOverScreen.style.display = 'none';
    startScreen.style.display = 'block';
    tabelaFrame.classList.remove('show');
  });

  // Toggle leaderboard com anima√ß√£o
  tabelaBtn.addEventListener('click', () => {
    buttonClickSound.play();
    tabelaFrame.classList.toggle('show');
    updateLeaderboard();
  });

  function initGame() {
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');
    snake = [{x:10, y:10}];
    direction = 'RIGHT';
    score = 0;
    placeApple();
    document.addEventListener('keydown', handleKey);
    clearInterval(gameInterval);
    gameInterval = setInterval(gameLoop, 100);
  }

  function handleKey(e) {
    const key = e.key;
    if(key === 'ArrowUp' && direction !== 'DOWN') direction = 'UP';
    if(key === 'ArrowDown' && direction !== 'UP') direction = 'DOWN';
    if(key === 'ArrowLeft' && direction !== 'RIGHT') direction = 'LEFT';
    if(key === 'ArrowRight' && direction !== 'LEFT') direction = 'RIGHT';
  }

  function gameLoop() {
    const head = {...snake[0]};
    if(direction === 'UP') head.y--;
    if(direction === 'DOWN') head.y++;
    if(direction === 'LEFT') head.x--;
    if(direction === 'RIGHT') head.x++;
    
    // Check collision
    if(head.x < 0 || head.x >= 25 || head.y < 0 || head.y >= 25 || snake.some(seg => seg.x === head.x && seg.y === head.y)) {
      gameOver();
      return;
    }

    snake.unshift(head);

    // Eat apple
    if(head.x === apple.x && head.y === apple.y){
      score++;
      appleSound.play();
      placeApple();
    } else {
      snake.pop();
    }

    drawGame();
  }

  function placeApple() {
    apple = {x: Math.floor(Math.random()*25), y: Math.floor(Math.random()*25)};
    if(snake.some(seg => seg.x === apple.x && seg.y === apple.y)) placeApple();
  }

  function drawGame() {
    ctx.fillStyle = '#0a1f44';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = '#ff0000';
    ctx.fillRect(apple.x*20, apple.y*20, 20, 20);

    ctx.fillStyle = '#00ff00';
    snake.forEach(seg => ctx.fillRect(seg.x*20, seg.y*20, 20, 20));
  }

  function gameOver() {
    clearInterval(gameInterval);
    gameScreen.style.display = 'none';
    gameOverScreen.style.display = 'block';
    finalScore.innerText = `${playerName} (Sala: ${playerRoom}) - Pontos: ${score}`;

    // Save to leaderboard
    leaderboard.push({name: playerName, room: playerRoom, score});
    leaderboard.sort((a,b) => b.score - a.score);
    localStorage.setItem('snakeLeaderboard', JSON.stringify(leaderboard));
  }

  function updateLeaderboard() {
    scoreList.innerHTML = '';
    leaderboard.forEach(entry => {
      const li = document.createElement('li');
      li.innerText = `${entry.name} (Sala: ${entry.room}) - ${entry.score} pts`;
      scoreList.appendChild(li);
    });
  }

  // Show start screen initially
  startScreen.style.display = 'block';
</script>

</body>
</html>
