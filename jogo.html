<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jogo da Cobrinha ‚Äî Dupla 8¬∫A</title>
<style>
  :root{--green:#1dd1a1;--dark:#050505;--red:#ff2d2d}
  body{margin:0;font-family: "Segoe UI", Roboto, Arial, sans-serif;background:linear-gradient(180deg,#020206,#041016);color:#e6fff9;display:flex;flex-direction:column;align-items:center;min-height:100vh}
  header{width:100%;padding:18px;text-align:center}
  h1{margin:0;font-size:1.6rem;color:var(--green)}
  .board{display:flex;gap:28px;align-items:flex-start;margin-top:18px;flex-wrap:wrap;justify-content:center}
  .panel{background:#071017;padding:16px;border-radius:12px;border:3px solid rgba(29,209,161,0.12);box-shadow:0 15px 40px rgba(0,0,0,0.5)}
  .game-canvas{display:block;border:4px solid var(--green);background:#000;border-radius:6px}
  .controls{display:flex;flex-direction:column;gap:10px;padding:6px;min-width:260px}
  label{font-size:0.95rem;color:#bdfbe0}
  input{padding:10px;border-radius:8px;border:2px solid rgba(255,255,255,0.06);background:#061218;color:#dff;outline:none}
  .play-btn{margin-top:6px;padding:12px;background:linear-gradient(90deg,#00c853,var(--green));color:#002; font-weight:900;border-radius:10px;border:none;cursor:pointer}
  .play-btn[disabled]{opacity:.5;cursor:default}
  .info{color:#bdfbe0;font-size:0.95rem;margin-top:8px}
  .scorecard{margin-top:12px;color:#dff}
  .back-link{display:block;text-align:center;margin-top:18px;color:#9fe8c9;text-decoration:none}
  /* overlay death */
  .overlay{position:fixed;left:0;top:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;z-index:999;visibility:hidden;opacity:0;transition:all .25s}
  .overlay.show{visibility:visible;opacity:1}
  .death{background:var(--red);padding:28px;border-radius:12px;color:white;width:90%;max-width:520px;text-align:center;box-shadow:0 20px 60px rgba(255,0,0,0.18)}
  .death h2{font-size:2rem;margin:0 0 8px}
  .death p{font-size:1.1rem;margin:8px 0}
  .btn-restart{margin-top:12px;padding:12px 18px;background:#fff;color:#900;border-radius:10px;border:none;font-weight:800;cursor:pointer}
  @media(max-width:720px){.board{flex-direction:column;align-items:center}.controls{min-width:unset;width:90%}}
</style>
</head>
<body>
  <header>
    <h1>üêç Jogo da Cobrinha ‚Äî Dupla 8¬∫A</h1>
  </header>

  <div class="board">
    <div class="panel">
      <canvas id="canvas" class="game-canvas" width="420" height="420"></canvas>
    </div>

    <div class="panel controls">
      <label>Nome (apenas letras/n√∫meros):</label>
      <input id="playerName" placeholder="Ex: Matheus123" maxlength="20" />

      <label>Sala:</label>
      <input id="roomName" placeholder="Ex: 8A" maxlength="10" />

      <button id="playBtn" class="play-btn" disabled>JOGAR</button>

      <div class="info">
        <p>Comece preenchendo seu <strong>nome</strong> e a <strong>sala</strong>. Ao clicar <strong>JOGAR</strong> o jogo inicia.</p>
        <p>Comandos: setas do teclado ‚Üí mover.</p>
      </div>

      <div class="scorecard">
        <div id="displayPlayer">Jogador: ‚Äî</div>
        <div id="displayRoom">Sala: ‚Äî</div>
        <div id="displayScore">Pontua√ß√£o: 0</div>
      </div>

      <a class="back-link" href="processo.html">‚¨Ö Voltar para o processo</a>
    </div>
  </div>

  <!-- overlay tela de morte -->
  <div id="overlay" class="overlay">
    <div class="death">
      <h2>VOC√ä MORREU!</h2>
      <p id="finalText">Pontua√ß√£o: 0 ‚Äî Jogador: ‚Äî</p>
      <button id="restartBtn" class="btn-restart">RECOME√áAR</button>
    </div>
  </div>

<script>
/* -------------------------
  Jogo da cobrinha personalizado
   - precisa preencher nome + sala
   - bot√£o verde "JOGAR" inicia
   - cobra um pouco maior (inicial maior)
   - cresce ao comer ma√ß√£
   - sons via WebAudio
   - overlay de morte com pontua√ß√£o e restart
---------------------------*/
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const box = 20;
const gridSize = 21; // grid 21x21 -> 420px fits (21*20 = 420)
let snake = [];
let dir = null;
let food = null;
let gameInterval = null;
let speed = 110;
let score = 0;

const playBtn = document.getElementById('playBtn');
const playerNameInput = document.getElementById('playerName');
const roomInput = document.getElementById('roomName');
const displayPlayer = document.getElementById('displayPlayer');
const displayRoom = document.getElementById('displayRoom');
const displayScore = document.getElementById('displayScore');
const overlay = document.getElementById('overlay');
const restartBtn = document.getElementById('restartBtn');
const finalText = document.getElementById('finalText');

playerNameInput.addEventListener('input', checkForm);
roomInput.addEventListener('input', checkForm);

function checkForm(){
  const a = playerNameInput.value.trim();
  const b = roomInput.value.trim();
  if(a.length>0 && b.length>0){
    playBtn.disabled = false;
  } else playBtn.disabled = true;
}

playBtn.addEventListener('click', () => {
  if(playBtn.disabled) return;
  startGame();
});

/* ---------------- WebAudio: sons curtos ---------------- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playPickupSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.setValueAtTime(880, audioCtx.currentTime);
  o.connect(g); g.connect(audioCtx.destination);
  g.gain.setValueAtTime(0, audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(0.12, audioCtx.currentTime + 0.01);
  o.start();
  o.frequency.exponentialRampToValueAtTime(1320, audioCtx.currentTime + 0.12);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.25);
  o.stop(audioCtx.currentTime + 0.26);
}
function playDeathSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type='sawtooth';
  o.frequency.setValueAtTime(220, audioCtx.currentTime);
  o.connect(g); g.connect(audioCtx.destination);
  g.gain.setValueAtTime(0.001, audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(0.18, audioCtx.currentTime + 0.02);
  o.start();
  o.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.9);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1.1);
  o.stop(audioCtx.currentTime + 1.12);
}

/* ----------------- l√≥gica do jogo ------------------ */
function resetState(){
  snake = [];
  // cobra um pouco mais esticada no come√ßo: 4 segmentos
  snake.push({x:10*box,y:10*box});
  snake.push({x:9*box,y:10*box});
  snake.push({x:8*box,y:10*box});
  snake.push({x:7*box,y:10*box});
  dir = 'RIGHT';
  placeFood();
  score = 0;
  displayScore.innerText = 'Pontua√ß√£o: 0';
}

function placeFood(){
  // garante que food n√£o aparece em cima da cobra
  let valid = false;
  while(!valid){
    const fx = Math.floor(Math.random()*gridSize)*box;
    const fy = Math.floor(Math.random()*gridSize)*box;
    valid = !snake.some(s=>s.x===fx && s.y===fy);
    if(valid) food = {x:fx,y:fy};
  }
}

function draw(){
  // fundo
  ctx.fillStyle = '#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // desenha ma√ß√£
  ctx.fillStyle = '#c92a2a';
  ctx.fillRect(food.x+3,food.y+3,box-6,box-6);
  // pequeno brilho
  ctx.fillStyle = '#ff6b6b';
  ctx.fillRect(food.x+8,food.y+6,6,6);

  // desenha cobra
  for(let i=0;i<snake.length;i++){
    ctx.fillStyle = i===0? '#1dd1a1' : '#0abf88';
    ctx.fillRect(snake[i].x, snake[i].y, box, box);
  }

  // mover cabe√ßa
  let headX = snake[0].x;
  let headY = snake[0].y;
  if(dir==='LEFT') headX -= box;
  if(dir==='RIGHT') headX += box;
  if(dir==='UP') headY -= box;
  if(dir==='DOWN') headY += box;

  // colis√£o com parede -> morte
  if(headX < 0 || headY < 0 || headX >= canvas.width || headY >= canvas.height){
    gameOver();
    return;
  }

  // se comeu a ma√ß√£
  if(headX === food.x && headY === food.y){
    // n√£o remove a cauda -> cresce
    playPickupSound();
    score++;
    displayScore.innerText = 'Pontua√ß√£o: ' + score;
    placeFood();
  } else {
    // movimento normal: remove cauda
    snake.pop();
  }

  const newHead = {x: headX, y: headY};

  // colis√£o com o pr√≥prio corpo
  if(snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)){
    gameOver();
    return;
  }

  snake.unshift(newHead);
}

/* detecta teclas para mudar dire√ß√£o */
document.addEventListener('keydown', (e)=>{
  const code = e.key;
  if(code==='ArrowLeft' && dir!=='RIGHT') dir='LEFT';
  if(code==='ArrowRight' && dir!=='LEFT') dir='RIGHT';
  if(code==='ArrowUp' && dir!=='DOWN') dir='UP';
  if(code==='ArrowDown' && dir!=='UP') dir='DOWN';
});

/* iniciar e parar o loop */
function startGame(){
  // reseta e oculta overlay
  resetState();
  overlay.classList.remove('show');
  // mostra player info
  displayPlayer.innerText = 'Jogador: ' + playerNameInput.value.trim();
  displayRoom.innerText = 'Sala: ' + roomInput.value.trim();
  // start loop
  if(gameInterval) clearInterval(gameInterval);
  gameInterval = setInterval(draw, speed);
  // bloquear inputs de nome/sala enquanto joga
  playerNameInput.disabled = true;
  roomInput.disabled = true;
  playBtn.disabled = true;
  // resume AudioContext on user gesture (required em alguns navegadores)
  if(audioCtx.state === 'suspended') audioCtx.resume();
}

function gameOver(){
  if(gameInterval) clearInterval(gameInterval);
  playDeathSound();
  // mostra overlay vermelho com pontua√ß√£o e nome
  finalText.innerText = 'Pontua√ß√£o: ' + score + ' ‚Äî Jogador: ' + (playerNameInput.value.trim() || '‚Äî');
  overlay.classList.add('show');
  // desbloquear para reiniciar
  restartBtn.focus();
}

restartBtn.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  // reset de estado e volta ao formul√°rio
  if(gameInterval) clearInterval(gameInterval);
  snake = [];
  dir = null;
  food = null;
  score = 0;
  displayScore.innerText = 'Pontua√ß√£o: 0';
  // permitir alterar nome/sala novamente
  playerNameInput.disabled = false;
  roomInput.disabled = false;
  playBtn.disabled = false;
  displayPlayer.innerText = 'Jogador: ‚Äî';
  displayRoom.innerText = 'Sala: ‚Äî';
  // limpa canvas
  ctx.clearRect(0,0,canvas.width,canvas.height);
});

/* initialize blank canvas */
ctx.fillStyle='#000';
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.fillStyle='#ffffff';
ctx.font='14px monospace';
ctx.fillText('Preencha o nome e a sala e clique em JOGAR', 12, 20);
</script>
</body>
</html>
